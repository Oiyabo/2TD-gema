<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Preview & Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        button.active {
            background: #28a745;
        }

        .tiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tile-item {
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
            background: #f9f9f9;
            transition: all 0.3s;
        }

        .tile-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-4px);
        }

        .tile-item canvas {
            border: 1px solid #ccc;
            background: white;
            display: block;
            margin: 0 auto 10px;
            image-rendering: pixelated;
        }

        .tile-item h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 8px;
            text-transform: capitalize;
        }

        .tile-item p {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .tile-item a {
            display: inline-block;
            padding: 6px 12px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 3px;
            font-size: 12px;
            transition: all 0.3s;
        }

        .tile-item a:hover {
            background: #764ba2;
        }

        .atlas-section {
            border-top: 2px solid #ddd;
            padding-top: 30px;
            margin-top: 30px;
        }

        .atlas-section h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .atlas-container {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }

        .atlas-container canvas {
            border: 2px solid #ccc;
            background: white;
            display: inline-block;
            image-rendering: pixelated;
            margin: 10px 0;
        }

        .stats {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 13px;
            color: #333;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #17a2b8;
        }

        .export-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .export-links a {
            padding: 12px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            text-align: center;
            transition: all 0.3s;
            font-weight: bold;
        }

        .export-links a:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Procedural Tile Generator</h1>
        <p class="subtitle">Generate and preview tiles for seamless autotiling system</p>

        <div class="controls">
            <button id="genTilesBtn">üé® Generate Tiles</button>
            <button id="genAtlasBtn">üì¶ Generate Atlas</button>
            <button id="downloadAllBtn">üíæ Download All</button>
            <button id="toggleSizeBtn">üîç Toggle Size</button>
        </div>

        <div id="status" class="info" style="display: none;"></div>

        <div id="tilesContainer" class="tiles-grid"></div>

        <div class="atlas-section">
            <h2>Tileset Atlas</h2>
            <div class="atlas-container">
                <canvas id="atlasCanvas" style="display: none;"></canvas>
                <p id="atlasStatus">Atlas not yet generated. Click "Generate Atlas" to create.</p>
            </div>

            <div id="exportLinks" class="export-links"></div>
        </div>

        <div class="stats">
            <strong>Generator Info:</strong><br>
            <div id="statsContent">Ready to generate tiles</div>
        </div>

        <footer>
            Procedural World Generator | Tile Preview Tool
        </footer>
    </div>

    <script type="module">
        import { BIOMES } from './js/biome.js';
        import { TileGenerator } from './js/tile-generator.js';

        let generator = new TileGenerator(64); // 64px for preview
        let previewSize = 3; // 3x scale

        // Define functions
        function generateTiles() {
            const status = document.getElementById('status');
            status.textContent = 'üé® Generating tiles...';
            status.style.display = 'block';

            try {
                generator.generateAllTiles();
                displayTiles();

                status.textContent = '‚úÖ Tiles generated successfully! ' + Object.keys(generator.getAllTiles()).length + ' tile images created.';
                status.className = 'success';

                updateStats();
            } catch (error) {
                status.textContent = '‚ùå Error: ' + error.message;
                status.className = 'info';
                console.error(error);
            }
        }

        function generateAtlas() {
            const status = document.getElementById('status');
            try {
                generator.createAtlas();
                displayAtlas();
                status.textContent = '‚úÖ Atlas generated successfully!';
                status.className = 'success';
                status.style.display = 'block';
                updateStats();
            } catch (error) {
                status.textContent = '‚ùå Error: ' + error.message;
                status.className = 'info';
                status.style.display = 'block';
            }
        }

        function downloadAllTiles() {
            // Check if tiles are generated
            const tiles = generator.getAllTiles();
            if (Object.keys(tiles).length === 0) {
                alert('Please generate tiles first!');
                return;
            }

            const exportLinks = document.getElementById('exportLinks');
            exportLinks.innerHTML = '<h3 style="grid-column: 1/-1; color: #333; margin-bottom: 10px;">üì• Download Links</h3>';

            // Individual tiles
            for (const [biomName, tileCanvas] of Object.entries(tiles)) {
                const link = document.createElement('a');
                link.href = tileCanvas.toDataURL('image/png');
                link.download = `tile-${biomName}.png`;
                link.textContent = `üì• ${biomName}`;
                exportLinks.appendChild(link);
            }

            // Atlas
            const atlasLink = document.createElement('a');
            atlasLink.href = generator.exportAtlasAsDataURL();
            atlasLink.download = 'tileset-atlas.png';
            atlasLink.textContent = 'üì¶ Full Atlas';
            atlasLink.style.gridColumn = '1/-1';
            atlasLink.style.fontSize = '14px';
            atlasLink.style.padding = '15px';
            atlasLink.style.background = '#28a745';
            exportLinks.appendChild(atlasLink);

            const status = document.getElementById('status');
            status.textContent = 'üíæ Download links ready! Your browser will download images.';
            status.className = 'success';
            status.style.display = 'block';
        }

        function togglePreviewSize() {
            previewSize = previewSize === 3 ? 5 : 3;
            displayTiles();
        }

        function displayTiles() {
            const container = document.getElementById('tilesContainer');
            container.innerHTML = '';

            for (const [biomName, tileCanvas] of Object.entries(generator.getAllTiles())) {
                const biomInfo = BIOMES[biomName] || {};

                const item = document.createElement('div');
                item.className = 'tile-item';

                // Create scaled display
                const displaySize = 64 * previewSize;
                const displayCanvas = document.createElement('canvas');
                displayCanvas.width = displaySize;
                displayCanvas.height = displaySize;
                const ctx = displayCanvas.getContext('2d');
                ctx.imageSmoothingEnabled = false;
                ctx.drawImage(tileCanvas, 0, 0, displaySize, displaySize);

                item.appendChild(displayCanvas);

                const title = document.createElement('h3');
                title.textContent = biomName;
                item.appendChild(title);

                const description = document.createElement('p');
                description.textContent = biomInfo.description || 'Generated tile';
                item.appendChild(description);

                const downloadLink = document.createElement('a');
                downloadLink.href = tileCanvas.toDataURL('image/png');
                downloadLink.download = `tile-${biomName}.png`;
                downloadLink.textContent = 'üì• Download';
                item.appendChild(downloadLink);

                container.appendChild(item);
            }
        }

        function displayAtlas() {
            const canvas = document.getElementById('atlasCanvas');
            const atlas = generator.getAtlas();

            if (atlas) {
                canvas.width = atlas.width;
                canvas.height = atlas.height;
                const ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = false;
                ctx.drawImage(atlas, 0, 0);
                canvas.style.display = 'block';

                document.getElementById('atlasStatus').style.display = 'none';

                // Scale for display
                canvas.style.width = (atlas.width * 3) + 'px';
                canvas.style.height = (atlas.height * 3) + 'px';
            }
        }

        function updateStats() {
            const statsContent = document.getElementById('statsContent');
            const tiles = generator.getAllTiles();
            const tileCount = Object.keys(tiles).length;
            const tileSize = 64;

            statsContent.innerHTML = `
                <strong>Generated Tiles:</strong> ${tileCount}<br>
                <strong>Tile Size:</strong> ${tileSize}√ó${tileSize} px<br>
                <strong>Preview Scale:</strong> ${previewSize}√ó<br>
                <strong>Biome Types:</strong> ${Object.keys(BIOMES).join(', ')}<br>
                <strong>Atlas Generated:</strong> ${generator.getAtlas() ? '‚úÖ Yes' : '‚ùå No'}<br>
                <strong>Canvas Rendering:</strong> ‚úÖ Procedural (no external assets needed)
            `;
        }

        // Setup event listeners
        document.getElementById('genTilesBtn').addEventListener('click', generateTiles);
        document.getElementById('genAtlasBtn').addEventListener('click', generateAtlas);
        document.getElementById('downloadAllBtn').addEventListener('click', downloadAllTiles);
        document.getElementById('toggleSizeBtn').addEventListener('click', togglePreviewSize);

        // Initial setup
        console.log('üé® Tile Generator loaded');
        console.log('Available biomes:', Object.keys(BIOMES).length);
        updateStats();
    </script>
</body>
</html>
